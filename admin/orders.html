<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Đơn hàng</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-expand-lg bg-white shadow-sm mb-4">
      <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">Nhà thuốc</a>
        <div class="navbar-nav">
          <a class="nav-link" href="products.html">Sản phẩm</a>
          <a class="nav-link active" href="orders.html">Đơn hàng</a>
          <a class="nav-link" href="categories.html">Danh mục</a>
          <a class="nav-link" href="employees.html">Nhân viên</a>
          <a class="nav-link" href="donvitinh.html">Đơn vị tính</a>
        </div>
      </div>
    </nav>
    <main class="container">
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="bg-white p-3 rounded-3 shadow-sm">
            <h5 class="mb-3">Tạo đơn hàng</h5>
            <form id="fOrder">
              <div class="row g-2">
                <div class="col-6">
                  <input
                    class="form-control"
                    name="manv"
                    placeholder="Mã nhân viên"
                    type="number"
                    required
                  />
                </div>
                <div class="col-12">
                  <textarea
                    class="form-control"
                    name="items"
                    rows="3"
                    placeholder='Items JSON, ví dụ: [{"masp":1,"sl":2,"gia":12000}]'
                    required
                  ></textarea>
                </div>
                <div class="col-12">
                  <button class="btn btn-success">Tạo đơn</button>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="bg-white p-3 rounded-3 shadow-sm">
            <h5 class="mb-3">Danh sách đơn hàng</h5>
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Số ĐH</th>
                  <th>Ngày lập</th>
                  <th>Giá trị</th>
                </tr>
              </thead>
              <tbody id="orders"></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
    <script>
      const API = (p) => (window.API_BASE || "../api/index.php") + "?r=" + p;
      async function loadOrders() {
        const res = await fetch(API("donhang"));
        const data = await res.json();
        document.getElementById("orders").innerHTML = data
          .map(
            (r) =>
              `<tr><td>${r.sodh}</td><td>${r.ngaylap}</td><td>${r.tongtien}</td></tr>`
          )
          .join("");
      }
      document
        .getElementById("fOrder")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const fd = new FormData(e.target);
          const payload = {
            manv: parseInt(fd.get("manv")),
            items: JSON.parse(fd.get("items")),
          };
          await fetch(API("donhang"), {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          e.target.reset();
          loadOrders();
        });
      window.API_BASE = "../api/index.php";
      loadOrders();
    </script>
  </body>
</html>
