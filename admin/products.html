<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sản phẩm</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-expand-lg bg-white shadow-sm mb-4">
      <div class="container">
        <a class="navbar-brand fw-bold" href="index.html">Nhà thuốc</a>
        <div class="navbar-nav">
          <a class="nav-link active" href="products.html">Sản phẩm</a>
          <a class="nav-link" href="orders.html">Đơn hàng</a>
          <a class="nav-link" href="categories.html">Danh mục</a>
          <a class="nav-link" href="employees.html">Nhân viên</a>
          <a class="nav-link" href="donvitinh.html">Đơn vị tính</a>
        </div>
      </div>
    </nav>
    <main class="container">
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="bg-white p-3 rounded-3 shadow-sm">
            <h5 class="mb-3">Thêm sản phẩm</h5>
            <form id="fAdd">
              <div class="row g-2">
                <div class="col-12">
                  <input
                    class="form-control"
                    name="tensp"
                    placeholder="Tên sản phẩm"
                    required
                  />
                </div>
                <div class="col-6">
                  <input
                    class="form-control"
                    name="giaban"
                    placeholder="Giá bán"
                    type="number"
                    step="0.01"
                  />
                </div>
                <div class="col-6">
                  <input
                    class="form-control"
                    name="gianhap"
                    placeholder="Giá nhập"
                    type="number"
                    step="0.01"
                  />
                </div>
                <div class="col-6">
                  <input
                    class="form-control"
                    name="madm"
                    placeholder="Mã danh mục"
                    type="number"
                  />
                </div>
                <div class="col-6">
                  <input
                    class="form-control"
                    name="madv"
                    placeholder="Mã đơn vị"
                    type="number"
                  />
                </div>
                <div class="col-12">
                  <textarea
                    class="form-control"
                    name="congdung"
                    placeholder="Công dụng"
                  ></textarea>
                </div>
                <div class="col-12">
                  <button class="btn btn-primary">Lưu</button>
                </div>
              </div>
            </form>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="bg-white p-3 rounded-3 shadow-sm">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Danh sách sản phẩm</h5>
              <input
                id="kw"
                class="form-control w-auto"
                placeholder="Tìm tên..."
              />
            </div>
            <table class="table table-sm mt-3">
              <thead>
                <tr>
                  <th>Mã</th>
                  <th>Tên</th>
                  <th>Giá</th>
                </tr>
              </thead>
              <tbody id="tb"></tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
    <script>
      const API = (p) => (window.API_BASE || "../api/index.php") + "?r=" + p;
      const tb = document.getElementById("tb");
      async function load(q = "") {
        const url = API("sanpham") + (q ? "&q=" + encodeURIComponent(q) : "");
        const res = await fetch(url);
        const data = await res.json();
        tb.innerHTML = (data || [])
          .map(
            (r) =>
              `<tr><td>${r.masp}</td><td>${r.tensp}</td><td>${r.giaban}</td></tr>`
          )
          .join("");
      }
      document
        .getElementById("kw")
        .addEventListener("input", (e) => load(e.target.value));
      document.getElementById("fAdd").addEventListener("submit", async (e) => {
        e.preventDefault();
        const fd = new FormData(e.target);
        const payload = Object.fromEntries(fd.entries());
        payload.giaban = parseFloat(payload.giaban || 0);
        payload.gianhap = parseFloat(payload.gianhap || 0);
        payload.madm = parseInt(payload.madm || 0) || null;
        payload.madv = parseInt(payload.madv || 0) || null;
        await fetch(API("sanpham"), {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        e.target.reset();
        load();
      });
      window.API_BASE = "../api/index.php";
      load();
    </script>
  </body>
</html>
